<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>OCTRA API</title>
    <!-- Bootstrap core CSS -->
    <link href="../bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="../bootstrap/bootstrap-icons/bootstrap-icons.css" rel="stylesheet" type="text/css">

    <!-- Custom styles for this template -->
    <link href="../v1/style.css" rel="stylesheet" type="text/css">
</head>

<body>
<nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top" aria-label="Fourth navbar example">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">OCTRA API v<%= apiInformation.version %></a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsExample04"
                aria-controls="navbarsExample04" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarsExample04">
            <ul class="navbar-nav me-auto mb-2 mb-md-0 d-md-none">
                <li class="nav-item">
                    <a class="nav-link" data-hash="ResponseStructure"
                       aria-expanded="true" data-bs-toggle="collapse" data-bs-target="#navbarsExample04"
                       data-bcup-haslogintext="no" href="#ResponseStructure">
                        Response structure
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-hash="AppAuthorisation"
                       aria-expanded="true" data-bs-toggle="collapse" data-bs-target="#navbarsExample04"
                       data-bcup-haslogintext="no" href="#AppAuthorisation">
                        App Authorisation
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-hash="UserAuthentication"
                       aria-expanded="true" data-bs-toggle="collapse" data-bs-target="#navbarsExample04"
                       data-bcup-haslogintext="no" href="#UserAuthentication">
                        User Authentication
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-hash="UserAuthorisation"
                       aria-expanded="true" data-bs-toggle="collapse" data-bs-target="#navbarsExample04"
                       data-bcup-haslogintext="no" href="#UserAuthorisation">
                        User Authorisation
                    </a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" id="dropdown03"
                       aria-expanded="false">
                        API Methods
                    </a>
                    <ul class="dropdown-menu bg-dark" aria-labelledby="dropdown03">
                        <% for(var i = 0; i < commands.length; i++) { %>
                            <li class="nav-item">
                                <a class="dropdown-item" data-hash="<%= commands[i].name %>"
                                   data-bs-toggle="collapse" data-bs-target="#navbarsExample04"
                                   href="#<%= commands[i].name %>"><%= commands[i].name %>
                                    (<%= commands[i].type %>)</a>
                            </li>
                        <% } %>
                    </ul>
                </li>
                <li class="nav-item">

                    <ul class="navbar-nav">

                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>
<div class="row" style="margin-top:80px;">
    <nav id="navbar-sticky"
         class="navbar navbar-light bg-light col-md-4 col-lg-4 col-xl-3 px-1 bh-light position-fixed overflow-auto vh-100 d-none d-md-block">
        <nav class="nav flex-column">
            <a class="nav-link align-items-center rounded collapsed" data-hash="ResponseStructure" aria-expanded="true"
               data-bcup-haslogintext="no" href="#ResponseStructure">
                Response structure
            </a>
            <a class="nav-link align-items-center rounded collapsed" data-hash="AppAuthorisation" aria-expanded="true"
               data-bcup-haslogintext="no" href="#AppAuthorisation">
                App Authorisation
            </a>
            <a class="nav-link align-items-center rounded collapsed" data-hash="UserAuthentication" aria-expanded="true"
               data-bcup-haslogintext="no" href="#UserAuthentication">
                User Authentication
            </a>
            <a class="nav-link align-items-center rounded collapsed" data-hash="UserAuthorisation" aria-expanded="true"
               data-bcup-haslogintext="no" href="#UserAuthorisation">
                User Authorisation
            </a>
            <a class="nav-link btn-toggle align-items-center rounded collapsed" data-hash="APIMethods"
               data-bs-toggle="collapse"
               data-bs-target="#api-methods" aria-expanded="true" data-bcup-haslogintext="no" href="#APIMethods">
                API Methods
            </a>
            <div class="collapse show" id="api-methods">
                <nav class="nav btn-toggle-nav list-unstyled fw-normal pb-1 small flex-column">
                    <% for(var i = 0; i < commands.length; i++){ %>
                        <a class="nav-link" data-hash="<%= commands[i].name %>"
                           href="#<%= commands[i].name %>"><%= commands[i].name %></a>
                    <% } %>
                </nav>
            </div>
        </nav>
    </nav>


    <main class="col-12 col-sm-12 col-md-8 col-lg-8 col-xl-9 offset-md-4 offset-lg-4 offset-xl-3">
        <div id="main-inner" class="overflow-auto">
            <div id="main-content">
                <h1><%= apiInformation.name %> REST API Reference v<%= apiInformation.version %></h1>
                <br/>

                <h2 id="ResponseStructure">Response Structure</h2>
                <div class="card command">
                    <div class="card-body">
                        <p>Each response makes use of the same JSON schema:</p>
                        <textarea style="min-height:200px;"
                                  readonly><%= apiDefaultResponseSchema %></textarea>
                        <div class="alert alert-info">
                            "message" contains an error message if "status" is "error". Otherwise it
                            contains messages for developer only.
                        </div>
                    </div>
                </div>

                <h2 style="margin-top: 40px;" id="AppAuthorisation">App Authorisation</h2>
                <div class="card command">
                    <div class="card-body">
                        <p>
                            Each application, that uses this API needs an API key. The application has to
                            send
                            this API
                            key via Authorization Header. Developers have to ask the API owner to register
                            the
                            application.<br/><br/>
                            Example: <code>Authorization: Bearer 65423gzu123f647t123892r3j01r732h</code>
                        </p>
                    </div>
                </div>

                <h2 style="margin-top: 40px;" id="UserAuthentication">User Authentication</h2>
                <div class="card command">
                    <div class="card-body">
                        <p>
                            This API makes use of JWT (JSON Web Tokens). On successful signup/signin a token
                            is
                            returned
                            to the client application. The client application must add this token to each
                            API
                            request.
                        </p>
                    </div>
                </div>

                <h2 style="margin-top: 40px;" id="UserAuthorisation">User Authorisation</h2>
                <div class="card command">
                    <div class="card-body">
                        <p>
                            This API makes use of JWT (JSON Web Tokens). On successful signup/signin a token
                            is
                            returned
                            to the client application. The client application must add this token to each
                            API
                            request<br/><br/>

                            Append the JWT as <code>x-access-token</code> header to your request.
                        </p>
                    </div>
                </div>

                <h2 style="margin-top: 40px;" id="APIMethods">API Methods</h2>
                <hr style="margin-bottom: 10px;"/>

                <div class="commands">
                    <% for(var i = 0; i < commands.length; i++) { %>
                        <div class="card command" id="<%= commands[i].name %>">
                            <div class="card-header">
                                <span class="title">
                                    <%= commands[i].name %> <a href="#<%= commands[i].name %>"
                                                               data-hash="<%= commands[i].name %>"><i
                                                class="bi bi-link-45deg"></i></a>
                                </span>
                                <div class="info">
                                    <span class="badge pill bg-info"><i
                                                class="bi bi-shield-lock-fill"></i> App Token</span>
                                    <% if (commands[i].needsJWT) { %>
                                        <span class="badge pill bg-info"><i
                                                    class="bi bi-shield-lock-fill"></i> JWT</span>
                                    <% } %>
                                </div>
                            </div>
                            <div class="card-body">
                                <table class="table">
                                    <% if (commands[i].allowedUserRoles.length > 0) { %>
                                        <tr>
                                            <td class="label">
                                                Allowed user roles:
                                            </td>
                                            <td><%= commands[i].allowedUserRoles.join(', ') %></td>
                                        </tr>
                                    <% } %>
                                    <tr>
                                        <td class="label">
                                            URL:
                                        </td>
                                        <td><code><%= url %><%= commands[i].url %></code></td>
                                    </tr>
                                    <tr>
                                        <td class="label">
                                            Description:
                                        </td>
                                        <td><p><%= commands[i].description %></p></td>
                                    </tr>
                                    <tr>
                                        <td class="label">Method:</td>
                                        <td>
                                            <span class="badge rounded-pill bg-secondary"><%= commands[i].type %></span>
                                        </td>
                                    </tr>
                                    <% if (commands[i].requestStructure) { %>
                                        <% if (commands[i].acceptedContentType) { %>
                                            <tr>
                                                <td class="label">Request Content Type:</td>
                                                <td><%= commands[i].acceptedContentType %></td>
                                            </tr>
                                        <% } %>
                                    <% } %>
                                    <% if (commands[i].responseStructure) { %>
                                        <tr>
                                            <td class="label">Response Content Type:</td>
                                            <td><%= commands[i].responseContentType %></td>
                                        </tr>
                                    <% } %>
                                    <% if (commands[i].requestStructure) { %>
                                        <tr>
                                            <td colspan="2">
                                                <span class="label">Request Schema:
                                                    <% if (commands[i].type === 'GET') { %>
                                                        (GET parameters in URL)
                                                    <% } else { %>
                                                        (Body)
                                                    <% } %>
                                                    :<br/>
                                                    </span>
                                                <textarea
                                                        readonly><%= commands[i].requestStructure %></textarea>
                                            </td>
                                        </tr>
                                    <% } %>
                                    <% if (commands[i].responseStructure) { %>
                                        <tr>
                                            <td colspan="2">
                                                <span class="label">Response Schema:</span><br>
                                                <textarea
                                                        readonly><%= commands[i].responseStructure %></textarea>
                                            </td>
                                        </tr>
                                    <% } %>
                                </table>
                            </div>
                        </div>
                        <hr/>
                    <% } %>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="../bootstrap/js/vendor/jquery.min.js"></script>
<!-- <script src="../bootstrap/js/vendor/popper.min.js"></script> -->
<script src="../bootstrap/js/bootstrap.bundle.js"></script>
<script>
    $(document).ready(function () {
        new bootstrap.ScrollSpy(document.getElementById("main-inner"), {
            target: '#navbar-sticky',
            method: "position",
            offset: 80
        })
        if (document.location.hash) {
            jumpTo(20);
        }

        $("a[data-hash]").on("click", function (event) {
            event.preventDefault();
            location.hash = $(this).attr("data-hash");
            jumpTo(20);
        })
    });

    function jumpTo(offset) {
        const elem = $(document.location.hash);
        const main = $("#main-inner");
        if (main) {
            if (elem) {
                console.log(`jump to ${elem[0].offsetTop - offset}`);
                main.scrollTop(elem[0].offsetTop - offset);
            } else {
                console.log(`could not find elem!`);
            }
        } else {
            console.log(`could not find main!`);
        }
    }
</script>
</body>
</html>
